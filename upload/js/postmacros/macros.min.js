!function(c,b,a,d){XenForo.PostMacros=function(e){this.__construct(e)};XenForo.PostMacros.prototype={__construct:function(e){console.log(e);this.$macros=e;if(!this.$macros.data("editorid")){console.error("Post Macros: There is no editor ID on the macro select. Aborting setup & hiding select.");this.$macros.xfRemove("xfHide");return}this.$macros.bind("change",c.context(this,"macroSelected"));this.updateVars();this.titleField=c("#ctrl_title_thread_create");this.noForm=false},updateVars:function(){var f=c("form");var e=this;jQuery.each(f,function(g,h){$editor=XenForo.getEditorInForm(h,"#"+e.escape(e.$macros.data("editorid"))+"_html");if($editor){e.$editor=$editor;e.$form=h;return false}});if(!this.$editor){jQuery.each(f,function(g,h){$editor=XenForo.getEditorInForm(h,"#"+e.escape(e.$macros.data("editorid")));if($editor){e.$editor=$editor;e.$form=h;return false}})}if(!this.$editor){console.warn("Post Macros: Unable to find editor! Post macros isn't going to work :( Getting rid of select.");this.$macros.xfRemove("xfHide");return}this.type=typeof(this.$editor.val)=="undefined"?"html":"plain"},macroSelected:function(){if(this.noForm){return}var e=this.$macros.val();if(e==0){return}this.updateVars();XenForo.ajax("index.php?post-macros/use",{macro_id:e,render:this.type=="html"?1:0,type:this.$macros.find(":selected").data("type"),formAction:this.$macros.closest("form").attr("action")},c.context(this,"successCallback"))},successCallback:function(f,i){if(this.noForm){return}if(f.templateHtml){this.$macros.val(0);XenForo.ajaxError(f);return}if(f.macroContent){switch(this.type){case"html":try{this.$editor.insertHtml(f.macroContent.toString())}catch(g){this.$editor.execCommand("mceInsertContent",false,f.macroContent.toString())}break;case"plain":this.$editor.val(this.$editor.val()+f.macroContent.toString().replace(/<br \/>/g,""));break}}console.log(this.titleField);if(f.threadTitle&&this.titleField&&this.titleField.val()==""){this.titleField.val(f.threadTitle)}if(f.lockThread){console.log("Locking thread");var e=c("#ctrl_macros_set_locked");if(e){e.remove()}c('<input id="ctrl_macros_set_locked" type="hidden" name="macros_set_locked" value="1" />').appendTo(this.$form)}if(f.threadPrefix){console.log("Setting prefix...");var h=c("#ctrl_macros_set_prefix");if(h){h.remove()}c('<input id="ctrl_macros_set_prefix" type="hidden" name="macros_set_prefix" value="'+f.threadPrefix+'" />').appendTo(this.$form)}this.$macros.val(0)},escape:function(e){return e.replace(/(:|\.|\[|\]|,)/g,"\\$1")}};XenForo.PostMacrosExpand=function(e){this.__construct(e)};XenForo.PostMacrosExpand.prototype={__construct:function(e){this.$macroId=e.data("macroid");this.$expandLink=e.find(".ExpandLink");this.$expandLink.bind("click",c.context(this,"expandCollapse"));this.$type=e.data("type")||"user";this.$ol=e},expandCollapse:function(e){e.preventDefault();if(this.$expandLink.text()==XenForo.phrases.postMacros_expand){this.expand()}else{this.collapse()}},expand:function(){if(typeof this.$templateHtml!="undefined"){this.$templateHtml.xfFadeDown()}else{XenForo.ajax("post-macros/expand",{macro_id:this.$macroId,type:this.$type},c.context(this,"expandTemplateReceived"))}this.$expandLink.text(XenForo.phrases.postMacros_collapse)},collapse:function(){this.$templateHtml.xfFadeUp();this.$expandLink.text(XenForo.phrases.postMacros_expand)},expandTemplateReceived:function(e){if(e.templateHtml){this.$templateHtml=c(e.templateHtml);this.$templateHtml.xfInsert("appendTo",this.$ol)}}};XenForo.register("select.MacroSelect","XenForo.PostMacros");XenForo.register(".MacroExpand","XenForo.PostMacrosExpand")}(jQuery,this,document);