!function(c,b,a,d){XenForo.MacrosButtons=function(e){this.__construct(e)};XenForo.MacrosButtons.prototype={__construct:function(e){this.textarea=e;c(a).bind({EditorInit:c.context(this,"editorInitFunc")})},editorInitFunc:function(i,h){this.$xenEditor=h;var f=this;if(h.$textarea[0]==this.textarea[0]&&h.editor.options.macros){var g={"user-0":{title:"User Macros",style:"opacity: 0.6; text-decoration: underline;"}};c.each(h.editor.options.macros.user,function(j,e){g["user-"+j]={title:e.title,callback:c.context(f,"insertMacroInternal")}});g["admin-0"]={title:"Admin Macros",style:"opacity: 0.6; text-decoration: underline;"};c.each(h.editor.options.macros.admin,function(j,e){g["admin-"+j]={title:e.title,callback:c.context(f,"insertMacroInternal")}});console.log(h.editor.options.macrosMode);switch(h.editor.options.macrosMode){case"insert-modal":h.config.buttonsCustom.insert.dropdown.macros_button={callback:c.context(this,"macrosButtonCallback"),title:this.$xenEditor.editor.getText("liam_postMacros_macro"),className:"icon insertMacro"};break;case"modal":h.config.buttons.push(["macros_button"]);h.config.buttonsCustom.macros_button={callback:c.context(this,"macrosButtonCallback"),title:this.$xenEditor.editor.getText("liam_postMacros_insert_macro"),className:"icon insertMacro"};break;case"embedded":h.config.buttons.push(["macros_button"]);h.config.buttonsCustom.macros_button={func:"show",title:this.$xenEditor.editor.getText("liam_postMacros_insert_macro"),dropdown:g};break;default:console.error("Invalid macros mode!")}}},insertMacroInternal:function(g,j,f,h){if(typeof h==="undefined"){var i=f.split("-");h=i[0];f=i[1]}XenForo.ajax("index.php?post-macros/use",{macro_id:f,render:1,type:h,formAction:g.$el.closest("form").attr("action")},function(e,l){if(e.macroContent){g.execCommand("inserthtml",e.macroContent.toString())}var k=c("#ctrl_title_thread_create");if(e.threadTitle&&k&&k.val==""){k.val(e.threadTitle)}if(e.lockThread){console.log("Locking thread");c('<input type="hidden" name="macros_set_locked" value="1" />').appendTo(self.$form)}if(e.threadPrefix){console.log("Setting prefix...");c('<input type="hidden" name="macros_set_prefix" value="'+e.threadPrefix+'" />').appendTo(self.$form)}g.syncCode();g.modalClose()})},macrosButtonCallback:function(f){var e=this;f.modalInit(this.$xenEditor.editor.getText("liam_postMacros_insert_macro"),{url:this.$xenEditor.editor.dialogUrl+"&dialog=liam_postmacros"},600,c.proxy(function(){c("#liam_postmacros_insert_btn").click(function(g){g.preventDefault();e.insertMacro(g,f)});setTimeout(function(){e.$macroSelect=c("#liam_postmacros_select");e.$macroSelect.focus()},100)}),f)},insertMacro:function(i,h){var g=this;g.macroForm=h.$el.closest("form");var f=g.$macroSelect.val();if(f==0){return}this.insertMacroInternal(h,i,f,g.$macroSelect.find(":selected").data("type"))},escape:function(e){return e.replace(/(:|\.|\[|\]|,)/g,"\\$1")}};XenForo.register("textarea.BbCodeWysiwygEditor","XenForo.MacrosButtons")}(jQuery,this,document);